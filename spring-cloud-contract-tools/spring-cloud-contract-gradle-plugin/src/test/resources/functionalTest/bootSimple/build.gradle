buildscript {
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath "org.springframework.boot:spring-boot-gradle-plugin:1.4.0.RELEASE"
	}
}

apply plugin: 'groovy'
apply plugin: 'spring-cloud-contract'
apply plugin: 'maven-publish'
apply plugin: 'spring-boot'

group = 'org.springframework.cloud.testprojects'

ext {
	contractsDir = file("repository/mappings")
	stubsOutputDirRoot = file("${project.buildDir}/production/${project.name}-stubs/repository/")
	BOM_VERSION = "Dalston.BUILD-SNAPSHOT"
}

repositories {
	mavenCentral()
	mavenLocal()
	maven { url "http://repo.spring.io/snapshot" }
	maven { url "http://repo.spring.io/milestone" }
	maven { url "http://repo.spring.io/release" }
}

dependencyManagement {
	imports {
		mavenBom "org.springframework.cloud:spring-cloud-dependencies:$BOM_VERSION"
	}
}

dependencies {
	compile "org.springframework:spring-web"
	compile "org.springframework:spring-context-support:$springVersion"
	compile "org.codehaus.groovy:groovy-all"
	compile 'com.jayway.jsonpath:json-path-assert'

	testCompile "com.github.tomakehurst:wiremock"
	testCompile "org.spockframework:spock-spring:1.0-groovy-2.4"
	testCompile "ch.qos.logback:logback-classic:1.1.2"
	testCompile("org.springframework.cloud:spring-cloud-starter-contract-verifier")
}

contracts {
	baseClassForTests = 'org.springframework.cloud.contract.verifier.twitter.places.BaseMockMvcSpec'
	basePackageForTests = 'contracts'
	contractsDslDir = contractsDir
//	generatedTestSourcesDir = file("${project.rootDir}/src/test/groovy/")
	stubsOutputDir = stubsOutputDirRoot
	targetFramework = 'Spock'
}

generateContractTests.dependsOn generateWireMockClientStubs

wrapper {
	gradleVersion '2.2.1'
}

test {
	testLogging {
		exceptionFormat = 'full'
	}
}